<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta name="viewport" content="width=device-width" user-scalable="0">
    <style>
        *{
            margin:0;
            padding:0;
        }
        html,body{
            height: 100%;
            overflow: hidden;
        }
        #canvas{
            height: 100%;
            /*background: pink;*/
        }

    </style>
</head>
<body>
    <canvas id="canvas" width="750" height="1206"></canvas>
    <script>

        // requestAnimationFrame兼容写法
        if (!window.requestAnimationFrame) {
            window.requestAnimationFrame = function(fn) {
                setTimeout(fn, 17);
            };
        }

        

        var can = document.querySelector('#canvas');
        var img1 = new Image();
        img1.src = '1.jpg';
        var img2 = new Image();
        img2.src = '2.jpg';
        
        var ctx = can.getContext('2d');

        // 求出小奶奶左边和顶部的距离比例
        var sca = 511/638;

        // 求出小奶奶距离底部和距离顶部的比例
        var scaleHeight = (1206-638-100)/638;

        // 求出小奶奶距离右边和距离左边的比例
        var scaleWidth = sca*(750-511-62)/511;



        var drawScale = function () {

            // 大图片老奶奶的位置和宽高属性（小奶奶）
            this.sx = 511;
            this.sy = 638;
            this.sw = 62;
            this.sh = 100;

            // 首页老奶奶的位置和宽高属性（大奶奶）
            this.sx2 = 0;
            this.sy2 = 0;
            this.sw2 = 750;
            this.sh2 = 1206;

            // 计算出大奶奶和小奶奶的宽高比，用来进行同步缩放
            this.scaW = this.sw2 / this.sw;
            this.scaH = this.sh2 / this.sh;


            this.draw = function (){
                // 绘制（小奶奶）
               ctx.drawImage(img2,this.sx,this.sy,this.sw,this.sh,0,0,750,1206); 
                // 绘制（大奶奶）
               ctx.drawImage(img1,this.sx2,this.sy2,this.sw2,this.sh2); 
            }
            
        }

        var draw = function () {

            // 如果x轴没有到左上角0 0的位置就进行重绘
            if (drawImg.sx <= 0){
                drawImg.sx = 0;
                drawImg.sw = 750;
            }else{

                // 每一帧绘制的x位置根据比例递减
                drawImg.sx-=sca;

                // 重绘之后的宽度= 原来宽度 + x轴移动的距离 + 小奶奶距离右边和距离左边的比例
                // scaleWidth也是小奶奶右侧增大的距离
                drawImg.sw = drawImg.sw + sca + scaleWidth;

                // 重置大奶奶和小奶奶的宽比例，用来进行同步缩放
                drawImg.scaW = drawImg.sw2 /drawImg.sw;

                // 大奶奶的x轴重置 = 小奶奶x轴移动的距离 * 大奶奶和小奶奶的宽比例
                drawImg.sx2 += sca*drawImg.scaW;

                // 大奶奶的宽度重置 = 小奶奶x轴移动的距离 * 大奶奶和小奶奶的宽比例
                drawImg.sw2 = drawImg.sw2 - (sca+scaleWidth)*drawImg.scaW;
               
            }

            if (drawImg.sy <= 0){
                drawImg.sy = 0;
                drawImg.sh = 1206;
            }else{
                // 每一帧绘制的y位置根据比例递减
                drawImg.sy--;

                // scaleHidth也是小奶奶底部增大的距离
                drawImg.sh = drawImg.sh + 1 + scaleHeight;
                drawImg.scaH = drawImg.sh2 /drawImg.sh;
                drawImg.sy2 += drawImg.scaH;
                drawImg.sh2 = drawImg.sh2 - (1+ scaleHeight)*drawImg.scaH;
            }



            console.log('w: '+drawImg.sw);
            console.log('h: '+drawImg.sh);
            console.log('x: '+drawImg.sx);
            console.log('y: '+drawImg.sy);

            console.log('w2: '+drawImg.sw2);
            console.log('h2: '+drawImg.sh2);


            drawImg.draw();

        }

        var render = function () {

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            draw();
            if (drawImg.sx == 0 || drawImg.sy == 0)
                return
            requestAnimationFrame(render);
        };

        var drawImg = new drawScale();
        // setInterval(function(){
        //     if (drawImg.sx == 0 || drawImg.sy == 0)
        //         return
        //     render()
        // },200)
        
        img1.onload = function(){
            render()
        }

       
        
    </script>
</body>
</html>