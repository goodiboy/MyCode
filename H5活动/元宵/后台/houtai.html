<script>
    $(function () {
        var data = {
            __type: 'func_page__{$name}',
            __d: new Date().valueOf()
        };
        func_page_api(data);
    });

    function func_page_api_ok() {
        common_page_log_hide();
        func_page_ok_init(g_api_data);
    }

    function func_page_ok_init(data) {
        console.log(data);
        help_n = data.page.sum_add;
        is_help = data.page.entity_actlogd;
        bestScore = data.page.entity_actlog_y__master.actlog_int_01;
        is_sub = data.page.is_sub;
        bgMusic = $('#bgMusic')[0];
        masterName = data.common.entity_wxuser.wxuser_nickName;
        if (!is_sub) {
            $('.page_affirm').show();
        }


        $('#best-score').html(bestScore);
        if (!is_help) {
            func_help();
        } else {
            hasCount = data.page.entity_actlog_y__master.actlog_str_01;
            $count.html(hasCount);
        }
        $('.avatar').prop('src', data.common.entity_wxuser.wxuser_headimgurl);

        $('.tips-mask').click(function () {
            $(this).hide();
            global.initGame();
        });





        $('#music-icon').click(function () {
            var $this = $(this);
            if ($this.hasClass('off')) {
                $this.removeClass('off');
                bgMusic.play();
            } else {
                $this.addClass('off');
                bgMusic.pause();
            }
        });

        $('.btn-rule').click(function () {
            $('.rule-mask').show();
        });

        $('.ok_close').click(function () {
            $('.rule-cont').removeClass('bounceIn').addClass('bounceOutDown');
            setTimeout(function () {
                $('.rule-mask').hide();
                $('.rule-cont').removeClass('bounceOutDown').addClass('bounceIn');
            }, 780);
        });

        $('.btn-share').click(function () {
            $('#share_mask_img').prop('src', 'http://img.wx.xiao-bo.com/z/act/2019-010203/gzl-yxty/share-img.png');
            $('#share_mask').show();
        });

        $('.btn-start').click(function () {
            if (hasCount <= 0) {
                alert('没有游戏机会了，快去分享获得机会吧！');
                $('#share_mask_img').prop('src', 'http://img.wx.xiao-bo.com/z/act/2019-010203/gzl-yxty/share-img.png');
                $('#share_mask').show();
                return;
            }
            hasCount--;
            func_set_str(hasCount);
            $count.html(hasCount);
            global.initBg();
            $('.page-game').fadeIn();
            $('.page-index').fadeOut();
        });

        $('#btn-restart').click(function () {
            if (hasCount <= 0) {
                alert('没有游戏机会了，快去分享获得机会吧！');
                $('#share_mask_img').prop('src', 'http://img.wx.xiao-bo.com/z/act/2019-010203/gzl-yxty/share-img.png');
                $('#share_mask').show();
                return;
            }
            $('.result-cont').removeClass('bounceIn').addClass('bounceOutDown');
            setTimeout(function () {
                $('.result-mask').hide();
                $('.result-cont').removeClass('bounceOutDown').addClass('bounceIn');
                hasCount--;
                $count.html(hasCount);
                func_set_str(hasCount);
                global.initGame();
            }, 790);
        });

        // $(".btn_wyy").click(function () {
        //     $(".page_affirm").show();
        // });
        //
        // $(".page_affirm").click(function () {
        //     $(".qr_code").addClass('dOut');
        //     setTimeout(function () {
        //         $(".page_affirm").hide();
        //         $(".qr_code").removeClass('dOut');
        //     }, 600);
        // });
        // $(".qr_code").click(function (e) {
        //     e.stopPropagation();
        // });
        upShare();

    }


    function upShare() {
        $('#wx__desc').val(masterName + '以' + bestScore + '分 傲视群雄，你敢来挑战ta吗？');
        prop_shareData = func_init_shareData();
        func_init_share(prop_shareData);
    }


    function func_help__success(data, textStatus, jqXHR) {
        console.log(data);
        console.log(textStatus);
        console.log(jqXHR);

        if (data.errcode == 0) {
            func_set_str(10);
            hasCount = 10;
            $count.html(hasCount);
        } else {
            alert(data.errmsg);
        }
    }

    function func_set_int__success(data, textStatus, jqXHR) {
        console.log(data);
        console.log(textStatus);
        console.log(jqXHR);

        if (data.errcode == 0) {
            // alert('func_set_int__success:OK');


        } else {
            alert(data.errmsg);
        }
    }

    function func_set_str__success(data, textStatus, jqXHR) {
        console.log(data);
        console.log(textStatus);
        console.log(jqXHR);

        if (data.errcode == 0) {
            // alert('func_set_int__success:OK');
        } else {
            alert(data.errmsg);
        }
    }

    function func_onMenuShare_success(res) {
        if (is_help && hasCount <= 0) {
            hasCount = 10;
            $count.html(hasCount);
            func_set_str(hasCount);
        }
    }

</script>
